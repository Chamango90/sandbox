<html>
<head>
  <meta charset="utf-8"/>
  <script src="https://threejs.org/build/three.min.js"></script>
  <script src="https://threejs.org/examples/js/loaders/STLLoader.js"></script>
  <!-- <script src="./dat.gui.min.js"></script> -->
</head>
<body>

<script>
var container, camera, scene, renderer, STLloader, gui;
var defaultMaterial = new THREE.MeshPhongMaterial( { color: 0xAAAAAA, specular: 0x111111, shininess: 200 } );

init();
animate();

function makeColorMaterial(r, g, b) {
  var color = new THREE.Color();
  color.setRGB(r, g, b);
  return new THREE.MeshPhongMaterial({
    color : color.getHex(),
    opacity : 1,
    blending : THREE.NormalBlending
  });
};

function loadSTL(material, uri) {
  STLloader.load(uri,
     function ( geometry ) {
       geometry.computeFaceNormals();
       var mesh;
       if(material !== null) {
         mesh = new THREE.Mesh( geometry, material );
         //mesh.scale.set( 2, 2, 2 );
       } else {
         mesh = new THREE.Mesh( geometry, defaultMaterial );
       }
       scene.add( mesh )
     },
     /*onProgress=*/null,
     function onLoadError(error) {
       console.error(error);
     });
   };

// function setupJointGUI(joints) {
//     var jointGui = gui.addFolder( "Joint States" );
//     var jointStates = {
//     };
//     var jointCallback = function( index ) {
//       return function () {
//         console.log();( jointStates );
//       }
//     };
//     for ( var i = 0; i < joints.length; i ++ ) {
//       var jointName = joints[ i ];
//       jointStates[ jointName ] = 0;
//     }
//     for ( var i = 0; i < joints.length; i ++ ) {
//       jointGui.add( jointStates, joints[ i ] ).min( 0 ).max( 100 ).onChange( jointCallback( i ) );
//     }
//     jointGui.open();
//   }

function init(){
    container=document.createElement('div');
    document.body.appendChild(container);
    camera=new THREE.PerspectiveCamera(0.5, window.innerWidth / window.innerHeight,  1, 1000);
    camera.position.set(3, 0.15, 3);
    // gui = new dat.GUI();
    // setupJointGUI(["joint1", "joint2"]);
    // gui.width = 300;
    // gui.open();

    scene=new THREE.Scene();

    //var material = makeColorMaterial(10,20,30);
    //var material = new THREE.MeshPhongMaterial( { color: 0xff5533, specular: 0x111111, shininess: 200 } );
    //new THREE.MeshBasicMaterial( { color: 0x999999 } )


    // object
    // var loader = new THREE.STLLoader();
    //   loader.load( './stl/3knot.scad.stl', function ( geometry ) {
    //   // loader.load( 'https://raw.githubusercontent.com/start-jsk/denso/83689945402f389afa9bb32f47c97457557fdb9d/vs060/model/meshes/BASE_mesh.stl', function ( geometry ) {
    //   scene.add( new THREE.Mesh( geometry ) );
    // });
    var material = null
    var githubRepo = "PR2/pr2_common";
    var githubBranch = "/kinetic-devel"
    var relativePath = "/pr2_description/meshes/head_v0/"
    STLloader=new THREE.STLLoader();


    var file = "head_tilt.stl"
    loadSTL(material, "https://raw.githubusercontent.com/"+githubRepo+githubBranch+relativePath+file);
    var file = "head_pan.stl"
    loadSTL(material, "https://raw.githubusercontent.com/"+githubRepo+githubBranch+relativePath+file);

    scene.add( new THREE.HemisphereLight( 0x443333, 0x111122 ) );
    addShadowedLight( 1, 1, 1, 0xffffff, 1.35 );
    addShadowedLight( 0.5, 1, -1, 0xffaa00, 1 );

    // renderer

    renderer=new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);

    container.appendChild(renderer.domElement);

    window.addEventListener('resize', onWindowResize, false);}

function addShadowedLight( x, y, z, color, intensity ) {
		var directionalLight = new THREE.DirectionalLight( color, intensity );
		directionalLight.position.set( x, y, z );
		scene.add( directionalLight );
		directionalLight.castShadow = true;
		var d = 1;
		directionalLight.shadow.camera.left = -d;
		directionalLight.shadow.camera.right = d;
		directionalLight.shadow.camera.top = d;
		directionalLight.shadow.camera.bottom = -d;
		directionalLight.shadow.camera.near = 1;
		directionalLight.shadow.camera.far = 4;
		directionalLight.shadow.mapSize.width = 1024;
		directionalLight.shadow.mapSize.height = 1024;
		directionalLight.shadow.bias = -0.002;
	}

function addLight(x, y, z, color, intensity){
    var directionalLight=new THREE.DirectionalLight(color, intensity);
    directionalLight.position.set(x, y, z)
    scene.add(directionalLight);}

function onWindowResize(){
    camera.aspect=window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);}

  function animate(){
      requestAnimationFrame(animate);
      render();}

  function render(){
      var timer=Date.now() * 0.0005;
      r=150;
      camera.position.x=r*Math.cos(timer);
      camera.position.z=r*Math.sin(timer);
      camera.lookAt(scene.position);
      renderer.render(scene, camera);
      renderer.setClearColor(0xf5f5f5, 1);}
</script>

</body>
</html>
